---
interface Props {
    label?: string;
    class?: string;
    variant?: "default" | "header" | "mobile" | "footer";
}

const {
    label = "切换主题模式",
    class: className = "",
    variant = "default",
} = (Astro.props as Props) ?? {};
---

<div
	class={`theme-toggle ${className}`}
	data-theme-toggle-root
	data-variant={variant}
>
	<button
		type="button"
		class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-[var(--color-border-soft)] bg-transparent text-[var(--color-text-secondary)] transition-colors hover:text-[var(--color-accent)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-accent-soft)]"
		data-theme-toggle
		data-theme-preference="system"
		aria-label={label}
		title={label}
	>
		<span class="sr-only" data-theme-toggle-label>{label}</span>
		<span aria-hidden="true" class="icon-container">
			<!-- System: Lucide sun-moon 图标 -->
			<svg
				data-icon="system"
				class="theme-icon"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
			>
				<path d="M12 2v2" />
				<path d="M14.837 16.385a6 6 0 1 1-7.223-7.222c.624-.147.97.66.715 1.248a4 4 0 0 0 5.26 5.259c.589-.255 1.396.09 1.248.715" />
				<path d="M16 12a4 4 0 0 0-4-4" />
				<path d="m19 5-1.256 1.256" />
				<path d="M20 12h2" />
			</svg>

			<!-- Light: Lucide sun 图标 -->
			<svg
				data-icon="light"
				class="theme-icon"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
			>
				<circle cx="12" cy="12" r="4" />
				<path d="M12 2v2" />
				<path d="M12 20v2" />
				<path d="m4.93 4.93 1.41 1.41" />
				<path d="m17.66 17.66 1.41 1.41" />
				<path d="M2 12h2" />
				<path d="M20 12h2" />
				<path d="m6.34 17.66-1.41 1.41" />
				<path d="m19.07 4.93-1.41 1.41" />
			</svg>

			<!-- Dark: Lucide moon 图标 -->
			<svg
				data-icon="dark"
				class="theme-icon"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
			>
				<path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401" />
			</svg>
		</span>
	</button>
</div>

<script>
	import { bindThemeToggles } from "../scripts/theme.ts";

	const container =
		document.currentScript?.previousElementSibling?.closest(
			"[data-theme-toggle-root]",
		) ?? document;

	bindThemeToggles(container);
</script>

<style>
	.theme-toggle {
		display: inline-flex;
	}

	.theme-toggle [data-theme-toggle] {
		inline-size: 2.5rem;
		position: relative;
	}

	/* 图标容器 */
	.icon-container {
		display: flex;
		align-items: center;
		justify-content: center;
		position: relative;
		width: 1.25rem;
		height: 1.25rem;
	}

	/* 所有图标基础样式 */
	.theme-icon {
		position: absolute;
		width: 1.25rem;
		height: 1.25rem;
		transition:
			opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
			transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
			rotate 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
		opacity: 0;
		transform: scale(0.5) rotate(-90deg);
		transform-origin: center;
	}

	/* 显示当前图标 */
	.theme-toggle [data-theme-toggle][data-theme-preference="system"] [data-icon="system"],
	.theme-toggle [data-theme-toggle][data-theme-preference="light"] [data-icon="light"],
	.theme-toggle [data-theme-toggle][data-theme-preference="dark"] [data-icon="dark"] {
		opacity: 1;
		transform: scale(1) rotate(0deg);
	}

	/* 隐藏其他图标 */
	.theme-toggle [data-theme-toggle][data-theme-preference="system"] [data-icon="light"],
	.theme-toggle [data-theme-toggle][data-theme-preference="system"] [data-icon="dark"],
	.theme-toggle [data-theme-toggle][data-theme-preference="light"] [data-icon="system"],
	.theme-toggle [data-theme-toggle][data-theme-preference="light"] [data-icon="dark"],
	.theme-toggle [data-theme-toggle][data-theme-preference="dark"] [data-icon="system"],
	.theme-toggle [data-theme-toggle][data-theme-preference="dark"] [data-icon="light"] {
		opacity: 0;
		transform: scale(0.5) rotate(90deg);
		pointer-events: none;
	}

	/* 悬停效果 - 添加微妙的缩放 */
	.theme-toggle [data-theme-toggle]:hover .theme-icon[data-icon="system"],
	.theme-toggle [data-theme-toggle]:hover .theme-icon[data-icon="light"],
	.theme-toggle [data-theme-toggle]:hover .theme-icon[data-icon="dark"] {
		transform: scale(1.15) rotate(0deg);
	}

	:global(html[data-theme="dark"]) .theme-toggle [data-theme-toggle] {
		color: var(--color-text-muted);
	}

	:global(html[data-theme="dark"]) .theme-toggle [data-theme-toggle]:hover {
		color: var(--color-link-hover);
	}

	/* Header variant: 去掉边框，只保留图标 */
	.theme-toggle[data-variant="header"] [data-theme-toggle] {
		border: none;
		background: transparent;
	}

	.theme-toggle[data-variant="header"] [data-theme-toggle]:hover {
		background: transparent;
	}

	/* Mobile variant: 全宽按钮，左对齐 */
	.theme-toggle[data-variant="mobile"] {
		display: flex;
		width: 100%;
	}

	.theme-toggle[data-variant="mobile"] [data-theme-toggle] {
		width: 100%;
		justify-content: flex-start;
		padding: 0.5rem 0.75rem;
		gap: 0.75rem;
		border: none;
		background: transparent;
		text-align: left;
	}

	.theme-toggle[data-variant="mobile"] [data-theme-toggle]:hover {
		background: color-mix(in srgb, var(--color-accent) 8%, transparent);
	}

	.theme-toggle[data-variant="mobile"] [data-theme-toggle-label] {
		position: static;
		clip: auto;
		width: auto;
		height: auto;
		overflow: visible;
		white-space: normal;
	}

	.theme-toggle[data-variant="footer"] [data-theme-toggle] {
		height: 2.5rem;
		inline-size: 2.5rem;
		border-radius: 999px;
		border-color: color-mix(in srgb, var(--color-text-muted) 30%, transparent);
		background: color-mix(in srgb, var(--color-bg-surface) 92%, transparent);
		box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
		color: var(--color-text-secondary);
		transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
	}

	.theme-toggle[data-variant="footer"] [data-theme-toggle]:hover {
		background: color-mix(in srgb, var(--color-bg-muted) 86%, transparent);
		border-color: color-mix(in srgb, var(--color-accent) 18%, var(--color-border));
		color: var(--color-accent);
	}

	:global(html[data-theme="dark"]) .theme-toggle[data-variant="footer"] [data-theme-toggle] {
		border-color: color-mix(in srgb, var(--color-text-primary) 18%, transparent);
		background: color-mix(in srgb, var(--color-bg-surface) 35%, transparent);
		color: var(--color-text-muted);
		box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
	}

	:global(html[data-theme="dark"]) .theme-toggle[data-variant="footer"] [data-theme-toggle]:hover {
		background: color-mix(in srgb, var(--color-bg-surface) 55%, transparent);
		color: var(--color-link-hover);
		border-color: color-mix(in srgb, var(--color-accent) 20%, transparent);
	}
</style>
